{{ 'section-rich-text-v3.css' | asset_url | stylesheet_tag }}

{% liquid
  assign padding_top = section.settings.padding_top
  assign padding_bottom = section.settings.padding_bottom
  assign padding_top_mobile = section.settings.padding_top_mobile
  assign padding_bottom_mobile = section.settings.padding_bottom_mobile
  assign sizes = '(min-width: 750px) 50vw, 100vw'
  assign widths = '375, 550, 750, 1100, 1500, 1780'
  assign fetch_priority = 'auto'
  if section.index == 1
    assign fetch_priority = 'high'
  endif
%}

{% render 'section-paddings-v3',
  padding_top: padding_top,
  padding_bottom: padding_bottom,
  padding_top_mobile: padding_top_mobile,
  padding_bottom_mobile: padding_bottom_mobile
%}

{% if section.settings.bg_image_desk != blank %}
  <style>
    .section-{{ section.id }}--padding {
      background: url("{{ section.settings.bg_image_desk | img_url: 'master' }}") center center/cover no-repeat;
    }
  </style>
{% endif %}

{% if section.settings.bg_image_mob != blank %}
  <style>
    @media screen and (max-width: 990px) {
      .section-{{ section.id }}--padding {
        background: url("{{ section.settings.bg_image_mob | img_url: 'master' }}") center center/cover no-repeat;
      }
    }
  </style>
{% endif %}

<section class="rich-text-v3 section-{{ section.id }}--padding">
  <div class="c-container">
    <div class="rich-text-v3-wrapper">
      {% for block in section.blocks %}
       
        {% case block.type %}
          {% when 'heading' %}
            <h2 class="rich-text-v3-block rich-text-v3-heading {% if forloop.last %}last{% endif %}" {{ block.shopify_attributes }}>
              {{ block.settings.heading }}
            </h2>
           
          {% when 'text-with-background' %}
            <div class="rich-text-v3-block type-{{ block.type }} {% if forloop.last %}last{% endif %}" style="color: {{ block.settings.text_color }}; background: {{ block.settings.bg_color }};">
              {{ block.settings.text }}
            </div>

          {% when 'colored-text' %}
            <div class="rich-text-v3-block type-{{ block.type }} {% if forloop.last %}last{% endif %}">
              {{ block.settings.text }}
            </div>

          {% when 'content' %}
            <div class="rich-text-v3-block type-{{ block.type }} {% if forloop.last %}last{% endif %}">
              {% if block.settings.content_mobile != blank %}
                <div class="content mobile {% if block.settings.disable_spacing_mobile == true %}no-spacing{% endif %}">{{ block.settings.content_mobile }}</div>
              {% endif %}
              <div class="content {% if block.settings.disable_spacing == true %}no-spacing{% endif %}">{{ block.settings.content }}</div>
            </div>

          {% when 'image' %}
            <div class="rich-text-v3-block type-{{ block.type }} {% if forloop.last %}last{% endif %}">
              {% if block.settings.image_mobile != blank %}
                {{
                  block.settings.image_mobile
                  | image_url: width: 990
                  | image_tag:
                    width: block.settings.image_mobile.width,
                    sizes: sizes,
                    widths: '375, 550, 750, 990',
                    fetchpriority: fetch_priority,
                    alt: block.settings.image_mobile.alt,
                    class: 'mobile'
                }}
              {% endif %}

              {{
                block.settings.image
                | image_url: width: 1440
                | image_tag:
                  width: block.settings.image.width,
                  sizes: sizes,
                  widths: widths,
                  fetchpriority: fetch_priority,
                  alt: block.settings.image.alt
              }}
            </div>
        {% endcase %}
      {% endfor %}
    </div>
    
  </div>
</section>

{% schema %}
  {
    "name": "Rich text v3",
    "settings": [
      {
        "type": "image_picker",
        "id": "bg_image_desk",
        "label": "Background image desktop"
      },
      {
        "type": "image_picker",
        "id": "bg_image_mob",
        "label": "Background image mobile"
      },
      {
        "type": "header",
        "content": "Paddings"
      },
      {
        "type": "range",
        "id": "padding_top",
        "label": "Padding top",
        "min": 0,
        "max": 200,
        "step": 2,
        "unit": "px",
        "default": 120
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "label": "Padding bottom",
        "min": 0,
        "max": 200,
        "step": 2,
        "unit": "px",
        "default": 90
      },
      {
        "type": "range",
        "id": "padding_top_mobile",
        "label": "Padding top mobile",
        "min": 0,
        "max": 200,
        "step": 2,
        "unit": "px",
        "default": 66
      },
      {
        "type": "range",
        "id": "padding_bottom_mobile",
        "label": "Padding bottom mobile",
        "min": 0,
        "max": 200,
        "step": 2,
        "unit": "px",
        "default": 40
      }
    ],
    "blocks": [
      {
        "type": "heading",
        "name": "Heading",
        "settings": [
          {
            "type": "text",
            "id": "heading",
            "label": "Heading"
          }
        ]
      },
      {
        "type": "text-with-background",
        "name": "Text with background",
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "Text"
          },
          {
            "type": "color",
            "id": "text_color",
            "label": "Text color",
            "default": "#FF6A13"
          },
          {
            "type": "color",
            "id": "bg_color",
            "label": "Background color",
            "default": "#FF6A1326"
          }
        ]
      },
      {
        "type": "colored-text",
        "name": "Colored text",
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "Text"
          }
        ]
      },
      {
        "type": "content",
        "name": "Content",
        "settings": [
          {
            "type": "richtext",
            "id": "content",
            "label": "Content",
            "default": "<p></p>"
          },
          {
            "type": "checkbox",
            "id": "disable_spacing",
            "label": "Diabled spacing",
            "default": false
          },
          {
            "type": "richtext",
            "id": "content_mobile",
            "label": "Content mobile",
            "default": "<p></p>"
          },
          {
            "type": "checkbox",
            "id": "disable_spacing_mobile",
            "label": "Diabled spacing mobile",
            "default": false
          }
        ]
      },
      {
        "type": "image",
        "name": "Image",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image_mobile",
            "label": "Image mobile"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Rich text v3"
      }
    ]
  }
{% endschema %}
