{% liquid
  assign image_desktop = section.settings.image_desktop
  assign image_mobile = section.settings.image_mobile | default: image_desktop
  assign image_order_mobile = section.settings.image_order_mobile
  assign background = section.settings.background
  assign sizes = '(min-width: 750px) 50vw, 100vw'
  assign widths = '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840'
  assign fetch_priority = 'auto'
  if section.index == 1
    assign fetch_priority = 'high'
  endif
%}

{{ 'component-subscribe-banner.css' | asset_url | stylesheet_tag }}

{% if section.settings.bg_image_desktop != blank %}
  <style>
    .section-{{ section.id }}--padding {
      background: url("{{ section.settings.bg_image_desktop | img_url: 'master' }}") center center/cover no-repeat;
    }
  </style>
{% endif %}

{% if section.settings.bg_image_mobile != blank %}
  <style>
    @media screen and (max-width: 550px) {
      .section-{{ section.id }}--padding {
        background: url("{{ section.settings.bg_image_mobile | img_url: 'master' }}") center center/cover no-repeat;
      }
    }
  </style>
{% endif %}

{% if section.settings.heading_icon != blank %}
  <style>
    .section-{{ section.id }}--padding .subscribe__banner-heading::before {
      content: "";
      position: absolute;
      top: 0;
      left: -25px;
      width: 14px;
      height: 28px;
      background-image: url("{{ section.settings.heading_icon | img_url: 'master' }}");
      background-repeat: no-repeat;
      background-size: cover;
    }

    @media screen and (max-width: 990px) {
      .section-{{ section.id }}--padding .subscribe__banner-heading::before {
        background-size: contain;
        width: 9px;
        height: 17.8px;
        left: 5px;
      }
    }
  </style>
{% endif %}

{% assign block_count = 0 %}
{% for block in section.blocks %}
  {% if block.type == 'icon-text' %}
    {% assign block_count = block_count | plus: 1 %}
  {% endif %}
{% endfor %}

<section class="subscribe__banner section-{{ section.id }}--padding">
  <div class="c-container">
    <div class="subscribe__banner-wrapper">
      <div class="subscribe__banner-column subscribe__banner-column_text">
        {% if section.settings.heading != blank %}
          <h2 class="subscribe__banner-heading">
            {{ section.settings.heading }}
          </h2>
        {% endif %}
        {% if block_count > 0 %}
          <div class="subscribe__banner-items">
            {% for block in section.blocks %}
              <div class="subscribe__banner-item" {{ block.shopify_attributes }}>
                {% if block.settings.icon != blank %}
                  <img src="{{ block.settings.icon | image_url: width: 26, height: 26 }}" alt="{{ block.settings.icon.alt }}" loading="lazy" width="26" height="26">
                {% endif %}
                {% if block.settings.text_mobile != blank %}
                  <span class="mobile">{{ block.settings.text_mobile }}</span>
                {% endif %}
                {% if block.settings.text != blank %}
                  <span>{{ block.settings.text }}</span>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% endif %}
        {% if section.settings.image_mobile != blank %}
          <div class="subscribe__banner-mobile_image">
            {{
              section.settings.image_mobile
              | image_url: width: 990
              | image_tag:
                width: section.settings.image_mobile.width,
                sizes: sizes,
                widths: '375, 550, 750, 990',
                fetchpriority: fetch_priority,
                alt: section.settings.image_mobile.alt
            }} 
          </div>
        {% elsif section.settings.image_desktop != blank %}
           <div class="subscribe__banner-mobile_image">
            {{
              section.settings.image_desktop
              | image_url: width: 990
              | image_tag:
                width: section.settings.image_desktop.width,
                sizes: sizes,
                widths: '375, 550, 750, 990',
                fetchpriority: fetch_priority,
                alt: section.settings.image_desktop.alt
            }} 
          </div>
        {% endif %}
        <div class="subscribe__banner-review">
          {% if section.settings.people_review_image != blank %}
            <img src="{{ section.settings.people_review_image | img_url: 'master' }}" alt="{{ section.settings.people_review_image.alt }}" width="65" height="28" loading="lazy">
          {% endif %}
          <div class="stars">
            {% for i in (1..5) %}
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_18474_6318)">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M15.966 6.14569C15.8747 5.86617 15.6159 5.67793 15.3213 5.67793H10.221L8.64552 0.827098V0.826165C8.55328 0.546632 8.29446 0.358398 7.99987 0.358398C7.70622 0.358398 7.44645 0.546632 7.35516 0.827107L5.77869 5.67793H0.678458C0.383875 5.67793 0.125042 5.86617 0.03375 6.14569C-0.0575417 6.42522 0.0403333 6.73017 0.2794 6.90427L4.40646 9.90287L2.82998 14.7546C2.73869 15.0351 2.8394 15.34 3.07846 15.5123C3.19704 15.5979 3.33634 15.6413 3.47562 15.6413C3.61492 15.6413 3.75422 15.5979 3.87375 15.5113L7.99987 12.5137L12.125 15.5113C12.3632 15.6845 12.6841 15.6845 12.9222 15.5123C13.1613 15.34 13.261 15.0351 13.1697 14.7537L11.5933 9.90287L15.7213 6.90428C15.9594 6.73017 16.0582 6.42522 15.966 6.1457" fill="#FF6A13"/>
                </g>
                <defs>
                <clipPath id="clip0_18474_6318">
                <rect width="16" height="16" fill="white"/>
                </clipPath>
                </defs>
              </svg>
            {% endfor %}
          </div>
          {% if section.settings.review_text_mobile != blank %}
            <span class="mobile">{{ section.settings.review_text_mobile }}</span>
          {% endif %}
          {% if section.settings.review_text != blank %}
            <span>{{ section.settings.review_text }}</span>
          {% endif %}
        </div>
        <div class="subscribe__banner-cta_wrapper">
          {% if section.settings.cta_text != blank and section.settings.cta_link != blank %}
            <a href="{{ section.settings.cta_link }}" class="subscribe__banner-cta" style="--cta-background: {{ section.settings.cta_background }};">
              {{- section.settings.cta_text -}}
              {{ 'icon-landing-button-arrow.svg' | inline_asset_content }}
            </a>
          {% endif %}
          {% if section.settings.cta_additional_text != blank %}
            <div class="subscribe__banner-additiona_text">
              {% if section.settings.cta_additional_icon != blank %}
                <img src="{{ section.settings.cta_additional_icon | image_url: width: 28, height: 28 }}" alt="{{ section.settings.cta_additional_icon.alt }}" loading="lazy" width="28" height="28">
              {% endif %}
              <span>{{ section.settings.cta_additional_text }}</span>
            </div>
          {% endif %}
        </div>
      </div>
      <div class="subscribe__banner-column subscribe__banner-column_image">
      {% if section.settings.round_image != blank %}
        <img class="round-image" src="{{ section.settings.round_image | img_url: 'master' }}" alt="{{ section.settings.round_image.alt }}" loading="lazy" width="701" height="570">
      {% endif %}
      {%- if section.settings.image_desktop != blank -%}
        {{
          section.settings.image_desktop
          | image_url: width: 3840
          | image_tag:
            width: section.settings.image_desktop.width,
            sizes: sizes,
            widths: widths,
            fetchpriority: fetch_priority,
            alt: section.settings.image_desktop.alt
        }} 
      {%- endif -%}
      </div>
    </div>
  </div>
</section>

{% schema %}
  {
    "name": "Subscribe banner",
    "settings": [
      {
        "type": "image_picker",
        "id": "image_desktop",
        "label": "Image desktop"
      },
      {
        "type": "image_picker",
        "id": "round_image",
        "label": "Round image"
      },
      {
        "type": "image_picker",
        "id": "image_mobile",
        "label": "Image mobile"
      },
      {
        "type": "image_picker",
        "id": "bg_image_desktop",
        "label": "Background image desktop"
      },
      {
        "type": "image_picker",
        "id": "bg_image_mobile",
        "label": "Background image mobile"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      },
      {
        "type": "image_picker",
        "id": "heading_icon",
        "label": "Heading icon"
      },
      {
        "type": "text",
        "id": "review_text",
        "label": "Review text"
      },
       {
        "type": "text",
        "id": "review_text_mobile",
        "label": "Review text mobile"
      },
      {
        "type": "image_picker",
        "id": "people_review_image",
        "label": "People review image"
      },
      {
        "type": "text",
        "id": "cta_text",
        "label": "CTA Text"
      },
      {
        "type": "url",
        "id": "cta_link",
        "label": "CTA Link"
      },
      {
        "type": "color",
        "id": "cta_background",
        "label": "CTA Background",
        "default": "#FF6A13"
      },
      {
        "type": "text",
        "id": "cta_additional_text",
        "label": "CTA Additional text",
        "default": "90-Day Money-Back Guarantee"
      },
      {
        "type": "image_picker",
        "id": "cta_additional_icon",
        "label": "CTA Additional icon"
      }
    ],
    "blocks": [
      {
        "type": "icon-text",
        "name": "Icon/text",
        "settings": [
          {
            "type": "image_picker",
            "id": "icon",
            "label": "Icon"
          },          
          {
            "type": "text",
            "id": "text",
            "label": "Text"
          },
          {
            "type": "text",
            "id": "text_mobile",
            "label": "Text mobile"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Subscribe banner"
      }
    ]
  }
{% endschema %}
