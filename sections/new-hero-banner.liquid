{{ 'section-new-hero-banner.css' | asset_url | stylesheet_tag }}

{% liquid
  assign padding_top = section.settings.padding_top
  assign padding_bottom = section.settings.padding_bottom
  assign padding_top_mobile = section.settings.padding_top_mobile
  assign padding_bottom_mobile = section.settings.padding_bottom_mobile

  assign background_type = section.settings.background_type
  assign video_desktop = section.settings.video_desktop
  assign video_mobile = section.settings.video_mobile
  assign overlay_opacity = section.settings.overlay_opacity | times: 1.0 | divided_by: 100
  assign background_image = section.settings.image_background_desktop
  assign background_image_mobile = section.settings.image_background_mobile
  if section.settings.banner_height == 'adapt' and background_type == 'image' and background_image != blank
    assign ratio_percent = 1 | divided_by: background_image.aspect_ratio | times: 100 | append: '%'
  elsif section.settings.banner_height == 'adapt' and background_type == 'video' and video_desktop != blank
    assign ratio_percent = 1 | divided_by: video_desktop.aspect_ratio | times: 100 | append: '%'
  endif
  if section.settings.banner_height == 'adapt' and background_image_mobile != blank
    assign ratio_percent_mobile = 1 | divided_by: background_image_mobile.aspect_ratio | times: 100 | append: '%'
  elsif section.settings.banner_height == 'adapt' and background_type == 'video' and video_mobile != blank
    assign ratio_percent_mobile = 1 | divided_by: video_mobile.aspect_ratio | times: 100 | append: '%'
  endif

  assign content_alignment = section.settings.content_alignment
  assign content_vertical_position = section.settings.content_vertical_position
  assign content_horizontal_position = section.settings.content_horizontal_position
%}

{%- capture style_variables -%}
  {%- if section.settings.banner_height == 'custom' -%}
  --banner-custom-height: {{ section.settings.custom_height |  append: 'px' }};
  --banner-custom_height_mobile: {{ section.settings.custom_height_mobile |  append: 'px' }};
  {%- endif -%}
  --background: {{ section.settings.color_background }};
  {%- if section.settings.banner_height == 'adapt' -%}
    --ratio-percent: {{ ratio_percent | default: '50%' }};
    --ratio-percent-mobile: {{ ratio_percent_mobile | default: ratio_percent_mobile | default: '200%' }};
  {% endif %}
  {% if background_type == 'video' %}
    --overlay-opacity: {{ overlay_opacity }};
  {% endif %}
{%- endcapture -%}

{% render 'section-paddings',
  padding_top: padding_top,
  padding_bottom: padding_bottom,
  padding_top_mobile: padding_top_mobile,
  padding_bottom_mobile: padding_bottom_mobile
%}

<div class="new-hero-banner__wrapper new-hero-banner__wrapper--{{ section.settings.banner_height }}"
    style="{{ style_variables }}"

>
  {% if background_type == 'image' %}
    {%- if background_image != blank -%}
      {% render  'picture',
        image:  background_image,
        image_mobile: background_image_mobile,
        mobile_breakpoint: 750,
        widths_list:  '350,800, 1200, 1500, 1900, 2100, 2400, 2800, 3200',
        loading:  'eager',
        fetchpriority:  'high',
        class:  'new-hero-banner__image'
      %}
    {%- endif -%}
  {%- elsif background_type == 'video' -%}
      <div class="new-hero-banner__video-container">
        {% if video_mobile != blank  %}
          <video playsinline autoplay loop muted preload="metadata" class="new-hero-banner__video">
            <source src="{{ video_mobile.sources[1].url }}" type="video/mp4" media="(max-width: 749px)">
            <source src="{{ video_desktop.sources[1].url }}" type="video/mp4">
          </video>
        {%- else -%}
          {{ video_desktop | video_tag: autoplay: true, loop: true, muted: true, controls: false, class: 'new-hero-banner__video' }}
        {% endif %}
      </div>
  {% endif %}
  <div class="new-hero-banner__container page-width">
    <div class="new-hero-banner__content section-{{ section.id }}--padding page-width"
      style="--content-alignment: {{ content_alignment }};
            --content-vertical-position: {{ content_vertical_position }};
            --content-horizontal-position: {{ content_horizontal_position }};">
      {% content_for 'blocks' %}
    </div>
  </div>
</div>

{% schema %}
{
    "name": "New hero banner",
    "tag": "section",
    "class": "new-hero-banner",
    "settings": [
      {
        "type": "header",
        "content": "Layout"
      },
      {
        "type": "select",
        "id": "banner_height",
        "label": "Banner height",
        "default": "full",
        "options": [
          {
            "value": "full",
            "label": "Full screen"
          },
          {
            "value": "adapt",
            "label": "Adapt to image"
          },
          {
            "value": "custom",
            "label": "custom"
          }
        ]
      },
      {
        "type": "range",
        "id": "custom_height",
        "label": "Banner custom height",
        "min": 400,
        "max": 1400,
        "step": 10,
        "unit": "px",
        "default": 770,
        "visible_if": "{{ section.settings.banner_height == 'custom' }}"
      },
      {
        "type": "range",
        "id": "custom_height_mobile",
        "label": "Banner height mobile",
        "min": 400,
        "max": 1400,
        "step": 10,
        "unit": "px",
        "default": 820,
        "visible_if": "{{ section.settings.banner_height == 'custom' }}"
      },
      {
        "type": "select",
        "id": "content_vertical_position",
        "label": "Content vertical position",
        "default": "center",
        "options": [
          {
            "value": "flex-start",
            "label": "Top"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "flex-end",
            "label": "Bottom"
          }
        ]
      },
            {
        "type": "select",
        "id": "content_horizontal_position",
        "label": "Content horizontal position",
        "default": "center",
        "options": [
          {
            "value": "flex-start",
            "label": "Start"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "flex-end",
            "label": "End"
          }
        ]
      },
      {
        "type": "select",
        "id": "content_alignment",
        "label": "Content alignment",
        "default": "center",
        "options": [
          {
            "value": "flex-start",
            "label": "Start"
          },
                    {
            "value": "center",
            "label": "Center"
          },
                    {
            "value": "flex-end",
            "label": "End"
          }
        ]
      },
      {
        "type": "header",
        "content": "Section background"
      },
      {
        "type": "select",
        "id": "background_type",
        "label": "Background type",
        "default": "image",
        "options": [
          {
            "value": "video",
            "label": "Video"
          },
          {
            "value": "image",
            "label": "Image"
          }
        ]
      },
      {
        "type": "color_background",
        "id": "color_background",
        "label": "Color background"
      },
      {
        "type": "image_picker",
        "id": "image_background_desktop",
        "label": "Image background desktop",
        "visible_if": "{{ section.settings.background_type == 'image' }}"
      },
      {
        "type": "image_picker",
        "id": "image_background_mobile",
        "label": "Image background mobile",
        "visible_if": "{{ section.settings.background_type == 'image' }}"
      },
      {
        "type": "video",
        "id": "video_desktop",
        "label": "Video(Desktop)",
        "visible_if": "{{ section.settings.background_type == 'video' }}"

      },
      {
        "type": "video",
        "id": "video_mobile",
        "label": "Video(Mobile)",
        "visible_if": "{{ section.settings.background_type == 'video' }}"
      },
      {
        "type": "range",
        "label": "Overlay opacity",
        "id": "overlay_opacity",
        "min": 1,
        "max": 100,
        "step": 1,
        "unit": "%",
        "default": 10,
        "visible_if": "{{ section.settings.background_type == 'video' }}"
      },
      {
        "type": "header",
        "content": "Section paddings"
      },
      {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 400,
        "step": 4,
        "unit": "px",
        "label": "Padding top",
        "default": 64
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 400,
        "step": 4,
        "unit": "px",
        "label": "Padding bottom",
        "default": 64
      },
      {
        "type": "range",
        "id": "padding_top_mobile",
        "min": 0,
        "max": 400,
        "step": 4,
        "unit": "px",
        "label": "Padding top mobile",
        "default": 68
      },
      {
        "type": "range",
        "id": "padding_bottom_mobile",
        "min": 0,
        "max": 400,
        "step": 4,
        "unit": "px",
        "label": "Padding bottom mobile",
        "default": 68
      }
    ],
    "blocks": [{ "type": "@theme" }, { "type": "@app" }],
    "presets": [
    {
        "name": "New hero banner"
    }
  ]
}
{% endschema %}