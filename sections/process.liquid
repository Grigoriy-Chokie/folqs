{%- liquid
  assign padding_top = section.settings.padding_top | append: 'px'
  assign padding_bottom = section.settings.padding_bottom | append: 'px'
  assign padding_top_mobile = section.settings.padding_top_mobile | append: 'px'
  assign padding_bottom_mobile = section.settings.padding_bottom_mobile | append: 'px'
  assign icons_number = 0

  for block in section.blocks
    if block.type == 'advantage_icon'
      assign icons_number = icons_number | plus: 1
    endif
  endfor
-%}
{%- style -%}
  .process--{{section.id}} {
      padding-top: {{padding_top}};
      padding-bottom: {{padding_bottom}};
  }
  @media(max-width: 768px) {
      .process--{{section.id}} {
          padding-top: {{padding_top_mobile}};
          padding-bottom: {{padding_bottom_mobile}};
      }
  }

  .process--{{section.id}} .process__advantage_images{
    max-width: calc({{icons_number}}*60px + 40px*{{icons_number | minus: 1}});
  }
{%- endstyle -%}
{{ 'component-process.css' | asset_url | stylesheet_tag }}
{% capture stars %}{% render 'icon-stars' %}{%endcapture%}
<div class="process process--{{section.id}}">
  <div class="process__container page-width">
    {% for block in section.blocks %}
      <div class="process__block process__block--{{block.type}} {% unless block.settings.title_font_size == blank %}process__block--{{ block.settings.title_font_size }} {% endunless %}">
        {%- case block.type -%}
          {%- when 'content' -%}
            {%- liquid
              assign title = block.settings.title
              assign subtitle = block.settings.subtitle
              assign text = block.settings.text
            -%}
            {% if title != blank %}
              <h2 class="process__block-title">{{- title -}}</h2>
            {% endif %}
            {% if subtitle != blank %}
              <p class="process__block-subtitle">{{- subtitle -}}</p>
            {% endif %}
            {% if text != blank %}
              <div class="process__block-text">{{- text | replace: '[stars]', stars -}}</div>
            {% endif %}
            <div class="process__advantage_images">
              {%- for block in section.blocks -%}
                {%- case block.type -%}
                  {%- when 'advantage_icon' -%}
                    {%- if block.settings.advantage_icon != null -%}
                      <div class="advantage_image__item">
                        {{ block.settings.advantage_icon | image_url: width: 60 | image_tag: loading: 'lazy' }}
                      </div>
                    {%- endif -%}
                {%- endcase -%}
              {%- endfor -%}
            </div>
          {%- when 'media' -%}
            {% unless block.settings.section_number == 0 %}
              <span class="block-image__index-circle">
                {{ block.settings.section_number }}
              </span>
            {% endunless %}
            {% style %}
              .process--{{section.id}} .process__block-image img {
                object-fit: {{ block.settings.object_fit }};
              }
            {% endstyle %}
            {% if block.settings.type_media == 'video' and block.settings.video_desktop != blank %}
              <div class="process__block-video process__block-video--{{block.settings.media_height}}">
                {% if block.settings.video_mobile != blank %}
                  <video playsinline autoplay loop muted preload="metadata">
                    <source
                      src="{{ block.settings.video_mobile.sources[1].url }}"
                      type="video/mp4"
                      media="(max-width: 768px)"
                    >
                    <source src="{{ block.settings.video_desktop.sources[1].url }}" type="video/mp4">
                  </video>
                {%- else -%}
                  {{
                    block.settings.video_desktop
                    | video_tag: autoplay: true, loop: true, muted: true, controls: false
                  }}
                {% endif %}
              </div>
            {% else %}
              {% unless block.settings.image_as_code == blank %}
                <div class="process__block-image-as-code  {% unless block.settings.image_frame == blank %} process__block-image--{{ block.settings.image_frame }} {% endunless %} {% if section.settings.hide_media_on_mobile %} process__block-image--mobile-hidden{% endif %}">
                  {{ block.settings.image_as_code }}
                </div>
              {% elsif block.settings.image != blank %}
                {%- liquid  assign image = block.settings.image -%}
                <div class="process__block-image process__block-image--{{block.settings.media_height}} {% unless block.settings.image_frame == blank %} process__block-image--{{ block.settings.image_frame }} {% endunless %} {% if section.settings.hide_media_on_mobile %} process__block-image--mobile-hidden{% endif %}">
                  {{
                    image
                    | image_url: width: 1500
                    | image_tag: widths: '500,600,700,800,900,1000', loading: 'lazy', alt: image.alt
                    | default: 'Process image'
                  }}
                </div>
              {% endunless %}
            {% endif %}
        {%- endcase -%}
      </div>
    {% endfor %}
  </div>
</div>
{% schema %}
{
  "name": "Process",
  "tag": "section",
  "blocks": [
    {
      "type": "media",
      "name": "Media",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "type_media",
          "label": "Type of media",
          "default": "image",
          "options": [
            {
              "value": "image",
              "label": "Image"
            },
            {
              "value": "video",
              "label": "Video"
            }
          ]
        },
        {
          "type": "video",
          "id": "video_desktop",
          "label": "Video(Desktop)"
        },
        {
          "type": "video",
          "id": "video_mobile",
          "label": "Video(Mobile)"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Recommended size 600*600"
        },
        {
          "type": "html",
          "label": "Image as code",
          "id": "image_as_code",
          "info": "Wil replace the image if type of media is 'image'."
        },
        {
          "type": "select",
          "label": "Image frame",
          "id": "image_frame",
          "default": "all-rounded",
          "options": [
            {
              "label": "All rounded",
              "value": "all-rounded"
            },
            {
              "label": "Bottom corner not rounded",
              "value": "bottom-not-rounded"
            }
          ]
        },
        {
          "type": "select",
          "label": "Media height",
          "id": "media_height",
          "default": "600",
          "options": [
            {
              "label": "600px",
              "value": "600"
            },
            {
              "label": "400px",
              "value": "400"
            }
          ]
        },
        {
          "type": "select",
          "label": "Object fit ",
          "id": "object_fit",
          "default": "cover",
          "options": [
            {
              "label": "Contain",
              "value": "contain"
            },
            {
              "label": "Cover",
              "value": "cover"
            }
          ]
        },
        {
          "type": "number",
          "label": "Section number",
          "id": "section_number",
          "default": 0,
          "info": "The number will be displayed on top of the media. If set to 0 - will be hidden"
        }
      ]
    },
    {
      "type": "content",
      "name": "Content",
      "limit": 1,
      "settings": [
        {
          "type": "richtext",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "select",
          "label": "Title font size",
          "id": "title_font_size",
          "default": "48",
          "options": [
            {
              "label": "48px",
              "value": "48"
            },
            {
              "label": "36px",
              "value": "36"
            }
          ]
        },
        {
          "type": "textarea",
          "id": "subtitle",
          "label": "Sub-Title",
          "default": "Lorem ipsum dolor sit amet consectetur. Pellentesque sem molestie urna donec fermentum. Proin massa sit proin non cursus congue porttitor. Ac augue sapien mi aliquet convallis. Turpis mauris risus mauris lacus pellentesque amet porttitor."
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Main text"
        }
      ]
    },
    {
      "type": "advantage_icon",
      "name": "Advantage icon",
      "settings": [
        {
          "type": "image_picker",
          "label": "Advantage icon",
          "id": "advantage_icon",
          "info": "Advantage icon png/jpg format"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding top",
      "default": 95
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding bottom",
      "default": 95
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding top mobile",
      "default": 65
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding bottom mobile",
      "default": 65
    },
    {
      "type": "checkbox",
      "label": "Hide media on mobile",
      "id": "hide_media_on_mobile",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "Process"
    }
  ]
}
{% endschema %}
